extends layout

block content
    //mixin calculatePriority(item)
        if item.priority>5 || item.priority<0
            - console.error("Error: incorrect priority = '" + item.priority + "' for id '" + item.id + "'")
            return
        else
            if item.priority==0
                return

    mixin drawBlock(data)
        each item,index in data
            - var id=item.id
            //todo ѕоследнему li в каждом ul нужно присвоить class="last"
            li(id=id, class="listItemId"+(index==data.length ? " last" : "") )
                .grayLinesBlock
                    .listItemWrapper
                        input(id=id+"_Checkbox", class="checkbox", type="checkbox", oncange="markChangedItem(this.id)", checked=item.isDone)
                        em(id=id+"_Marker" class="marker close" onclick="collapseElement(this.id)")
                        .hintContainer
                            //todo calculate
                            progress(class="progressBar", value="53", max="325")
                            br
                            span(span class="hintText") 53/325
                        div(id=id+"_DropWrapper", class="dropdownWrapper")
                            button(id=id+"_PriorityButton", class="dropButton priorityDefault", onclick="switchDropdownList(this.id)")
                            div(id=id+"_PriorityDropDown", class="dropContent hidden")
                                each val, index in {0:'Default', 1:'1', 2:'2', 3:'3', 4:'4', 5:'5'}
                                    a(id=id+"_dropLink"+val, class="dropLink priority"+val, href="#", onclick="setPriority(this.id)")
                        a(id=id+"_Item", class="listItemLink", onclick="collapseElement(this.id)", onselectstart="return false", onmousedown="return false") #{item.name}
                        //todo если у элемента списка нет подстрок, то у ссылки <a> нужно убрать обработчик onclick="collapseElement(this.id) и в им€ класса добавить listItemLink
                        input(id=id+"_commentInput", class="textInput comment", type="text", value=item.id, oninput="markChangedItem(this.id)")
                        input(id=id+"_indexInput", class="textInput index", type="text", value="199/200", oninput="markChangedItem(this.id)")
                    if item.children
                        ul(id=item.id+"_ChildrenUl", class="subList hidden")
                            +drawBlock(item.children)

    ul#root
        +drawBlock(data)